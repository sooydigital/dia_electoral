{% extends "base.html" %} {% load permissions_tags %} {% load static %}

{% block content %}

    <h1 class="third_color_text text-center">
        <i class="fa  fa-calculator" aria-hidden="true"></i>

        DISTRIBUCIONES </h1>
    <br>
    {% for pull_base in pull_base_list %}
        <div class="col-md-12">
            <div class="card mb-4 box-shadow">
                <a class="text-decoration-none"
                   href="{% url 'app:distribucion' id=pull_base.id %}">
                    <div class="card-body text-center card_encuesta">
                        {{ pull_base.name }}
                    </div>
                </a>
            </div>
        </div>
    {% endfor %}


    {% if municipios %}
        <table class="table text-center">
            <thead class="thead-dark principal_color text-white">
            <tr>
                <th scope="col"> #</th>
                <th scope="col">Municipio</th>
                <th scope="col">Encuestas Realizadas / Encuestas Totales</th>
                <th scope="col">Encuestas Faltantes</th>
            </tr>
            </thead>
            <tbody>

            {% for municipio in municipios %}

                <tr>
                    <th scope="row"><span class="secondary_color_text font-weight-bold">{{ forloop.counter }}</span>
                    </th>
                    <td>

                        <a class="text-decoration-none" href="{% url 'app:distribucion' id=id municipio=municipio.municipio_slug %}">
                            {{ municipio.municipio_name }}
                        </a>

                    </td>
                    <td>{{ municipio.total_entregadas }} / {{ municipio.total_distribuciones }}</td>
                    <td>{{ municipio.total_distribuciones|difference:municipio.total_entregadas }}</td>
                </tr>

            {% endfor %}
            </tbody>
        </table>
    {% endif %}

    {% for distribucion in distribuciones %}

        <h2>
            <a href="{% url 'app:distribucion' %}" class="btn btn-primary">
                Volver
            </a>
            {{ distribucion.municipio }}
        </h2>

        <div class="table-responsive">
            <table id="distributions" class="table table-bordered text-center  ">
                <thead>
                <tr>
                    <th rowspan="2" class="align-middle">ITEM</th>
                    <th rowspan="2" class="align-middle">COMUNAS</th>
                    <th rowspan="2" class="align-middle">BARRIOS</th>
                    <th rowspan="2" class="align-middle">ESTRATO</th>
                    <th colspan="3">MUJERES</th>
                    <th colspan="3">HOMBRES</th>
                    <th rowspan="2" class="align-middle">TOTAL</th>
                </tr>
                <tr>
                    <th>18-35 Años</th>
                    <th>36-55 Años</th>
                    <th>>56 Años</th>

                    <th>18-35 Años</th>
                    <th>36-55 Años</th>
                    <th>>56 Años</th>
                </tr>


                </thead>
                <tbody>
                {% for comuna in distribucion.comunas %}
                    <tr>
                        <td rowspan="{{ comuna.barrios | length | add:1 }}"
                            class="align-middle"> {{ forloop.counter }} </td>
                        <td rowspan="{{ comuna.barrios | length | add:1 }}"
                            class="align-middle"> {{ comuna.name }} </td>
                    </tr>
                    {% for barrio in comuna.barrios %}
                        <tr>
                            <td>  {{ barrio.name }} </td>
                            <td>  {{ barrio.estrato }} </td>

                            <td>  {{ barrio.gender.MUJER.rango_1.value }} </td>
                            <td>  {{ barrio.gender.MUJER.rango_2.value }} </td>
                            <td>  {{ barrio.gender.MUJER.rango_3.value }} </td>


                            <td>  {{ barrio.gender.HOMBRE.rango_1.value }} </td>
                            <td>  {{ barrio.gender.HOMBRE.rango_2.value }} </td>
                            <td>  {{ barrio.gender.HOMBRE.rango_3.value }} </td>
                            <td> </td>

                        </tr>
                    {% endfor %}
                {% endfor %}

                </tbody>
            </table>
        </div>

    {% endfor %}

{% endblock %}


{% block scriptcontent %}
    <script>
    var resume_table = document.getElementById("distributions");
    fila_init = 3
    col_total = 8
    for (var i = 0, row; row = resume_table.rows[i]; i++) {
        if (i>=fila_init) {
            console.log('i', i)
            var total = 0
            for (var j = 0, col; col = row.cells[j]; j++) {
            console.log('j', j, col.innerText);
              if (j == col_total) {
                  col.innerText = total
              } else if ( j>= 2) {
                total = total + parseInt(col.innerText)
              }
            console.log(total, `Txt: ${col.innerText} \tFila: ${i} \t Celda: ${j}`);
            }
        }
    }

    </script>

{% endblock %}
