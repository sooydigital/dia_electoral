{% extends "base.html" %} {% load permissions_tags %} {% load static %}

{% block content %}

    <h1 class="third_color_text text-center">
        <i class="fa  fa-calculator" aria-hidden="true"></i>

        DISTRIBUCIONES </h1>
    <br>

    {% if registros %}
        <table class="table text-center">
            <thead class="thead-dark principal_color text-white">
            <tr>
                <th scope="col"> #</th>
                <th scope="col">Puesto</th>
                <th scope="col">Testigo CC</th>
                <th scope="col">Testigo nombre</th>
                <th scope="col">Mesa</th>
            </tr>
            </thead>
            <tbody>

            {% for registro in registros %}

                <tr>
                    <th scope="row"><span class="secondary_color_text font-weight-bold">{{ forloop.counter }}</span>
                    </th>
                    <td>{{ registro.mesa__puesto_votacion__nombre }}</td>
                    <td>{{ registro.testigo__username }}</td>
                    <td>{{ registro.testigo__first_name }}</td>
                    <td>{{ registro.mesa__numero }}</td>
                </tr>

            {% endfor %}
            </tbody>
        </table>
    {% endif %}

    {% for distribucion in distribuciones %}

        <h2>
            <a href="{% url 'app:distribucion' %}" class="btn btn-primary">
                Volver
            </a>
            {{ distribucion.municipio }}
        </h2>

        <div class="table-responsive">
            <table id="distributions" class="table table-bordered text-center  ">
                <thead>
                <tr>
                    <th rowspan="2" class="align-middle">ITEM</th>
                    <th rowspan="2" class="align-middle">COMUNAS</th>
                    <th rowspan="2" class="align-middle">BARRIOS</th>
                    <th rowspan="2" class="align-middle">ESTRATO</th>
                    <th colspan="3">MUJERES</th>
                    <th colspan="3">HOMBRES</th>
                    <th rowspan="2" class="align-middle">TOTAL</th>
                </tr>
                <tr>
                    <th>18-35 Años</th>
                    <th>36-55 Años</th>
                    <th>>56 Años</th>

                    <th>18-35 Años</th>
                    <th>36-55 Años</th>
                    <th>>56 Años</th>
                </tr>


                </thead>
                <tbody>
                {% for comuna in distribucion.comunas %}
                    <tr>
                        <td rowspan="{{ comuna.barrios | length | add:1 }}"
                            class="align-middle"> {{ forloop.counter }} </td>
                        <td rowspan="{{ comuna.barrios | length | add:1 }}"
                            class="align-middle"> {{ comuna.name }} </td>
                    </tr>
                    {% for barrio in comuna.barrios %}
                        <tr>
                            <td>  {{ barrio.name }} </td>
                            <td>  {{ barrio.estrato }} </td>

                            <td>  {{ barrio.gender.MUJER.rango_1.value }} </td>
                            <td>  {{ barrio.gender.MUJER.rango_2.value }} </td>
                            <td>  {{ barrio.gender.MUJER.rango_3.value }} </td>


                            <td>  {{ barrio.gender.HOMBRE.rango_1.value }} </td>
                            <td>  {{ barrio.gender.HOMBRE.rango_2.value }} </td>
                            <td>  {{ barrio.gender.HOMBRE.rango_3.value }} </td>
                            <td> </td>

                        </tr>
                    {% endfor %}
                {% endfor %}

                </tbody>
            </table>
        </div>

    {% endfor %}

{% endblock %}


{% block scriptcontent %}
    <script>
    var resume_table = document.getElementById("distributions");
    fila_init = 3
    col_total = 8
    for (var i = 0, row; row = resume_table.rows[i]; i++) {
        if (i>=fila_init) {
            console.log('i', i)
            var total = 0
            for (var j = 0, col; col = row.cells[j]; j++) {
            console.log('j', j, col.innerText);
              if (j == col_total) {
                  col.innerText = total
              } else if ( j>= 2) {
                total = total + parseInt(col.innerText)
              }
            console.log(total, `Txt: ${col.innerText} \tFila: ${i} \t Celda: ${j}`);
            }
        }
    }

    </script>

{% endblock %}
